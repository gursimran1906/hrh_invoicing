{% extends 'base.html' %} {% block title %}Attendance{% endblock %} 
{% block container %}



<div class="grid {% if days_of_month %}grid-cols-2{% endif %} grid-cols-1 mb-3">
    <form method="post" action="{% url 'clients_attendance' %}" >
        {% csrf_token %}

        <div class="grid grid-cols-2 justify-items-start">
            <div class='grid grid-cols-1 p-4 bg-white shadow-md rounded-lg '>
            
                <label for="monthPicker" class=" text-gray-900 dark:text-white">Select Month and Year:</label>
                <input
                    class='px-2 py-1 rounded-lg border'
                    type="month"
                    class="form-control "
                    id="monthPicker"
                    name="month_year"
                    value="{{ selected_month_year }}"
                    required
                />
                <button type="submit" class="mt-2 text-center text-white bg-blue-600 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg border text-sm px-2 me-4 py-2 dark:bg-blue-600 dark:hover:bg-blue-600 focus:outline-none dark:focus:ring-blue-800">Search</button>

            </div>
            
        </div>
    </form>
{% if days_of_month %}
<div class="grid grid-cols-1 justify-items-end h-fit self-top">
 
    
    <div class="justify-items-end bg-white rounded-lg shadow p-4  ">
        <h3 class=" text-center mb-2 text-xl w-full">Actions</h3>
       
        <a class=" text-center text-white bg-blue-600 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg border text-sm px-2 py-2 me-1 dark:bg-blue-600 dark:hover:bg-blue-600 focus:outline-none dark:focus:ring-blue-800"
        href="{% url 'generate_monthly_attendance_chart' month_year=selected_month_year %}">Dowload Chart</a>
        <a class=" py-2 px-2 mb-2 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border  hover:bg-blue-600 hover:text-white focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"
        href="{% url 'generate_monthly_attendance_table' month_year=selected_month_year %}">Download Table</a>
    </div>
</div>
{% endif %}
</div>

{% if days_of_month %}
<form class="bg-white p-4 mt-2 rounded-lg shadow-md" method="post" action="{% url 'mark_clients_attendance' %}" >
    {% if clients %}
    {% csrf_token %}
    <div class="overflow-x-auto">
        <table class="table-auto min-w-full divide-y divide-gray-200">
            
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky left-0 border-e">
                        Client Name
                    </th>
                    {% for day in days_of_month %}
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{{ day|date:"d/m/Y" }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody class="even:bg-white odd:dark:bg-gray-900 odd:bg-gray-50 divide-y divide-gray-200">
                {% for client in clients %}
                <tr class="">
                    <td class="px-6 py-4 whitespace-nowrap sticky left-0 bg-gray-50 border-e">
                        {{ client.name }}
                    </td>
                    
                    {% for day, present in client.attendance.items %}
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input name="{{ client.id }}/{{ day }}" class="form-checkbox h-4 w-4 text-indigo-600 transition duration-150 ease-in-out" type="checkbox" {% if present == True %}checked{% endif %}>
                    </td>
                    {% endfor %}
                    
                </tr>
                {% endfor %}
            </tbody>
            
            <tfoot class="bg-gray-50">
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap sticky left-0 bg-gray-50 border-e">
                        SELECT FOR ALL
                    </td>
                    {% for day in days_of_month %}
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input data-day="{{ day }}" class="form-checkbox h-4 w-4 text-indigo-600 transition duration-150 ease-in-out check-all-checkbox" type="checkbox">
                    </td>
                    {% endfor %}

                    <script>
                        document.querySelectorAll('.check-all-checkbox').forEach(function(checkAllCheckbox) {
                            checkAllCheckbox.addEventListener('change', function() {
                                var day = this.dataset.day;
                                var checkboxes = document.querySelectorAll('[name*="/' + day + '"]');
                                checkboxes.forEach(function(checkbox) {
                                    checkbox.checked = checkAllCheckbox.checked;
                                });
                            });
                        });
                    </script>

                </tr>
            </tfoot>
            
        </table>
    </div>
    <button type="submit" class="mt-2 text-center text-white bg-blue-600 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg border text-sm px-2 py-2 me-1 dark:bg-blue-600 dark:hover:bg-blue-600 focus:outline-none dark:focus:ring-blue-800">Mark Attendance</button>
    {% else %}
            No clients for that period
            {% endif %}
</form>

{% endif %}


{% endblock %}
